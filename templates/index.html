<!DOCTYPE html>
<html lang="zh-Hant">
    
<head>
  <meta charset="UTF-8">
  <title>è™›æ“¬å†°ç®±</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet">
</head>
<body onload="openFridge()">
  <div class="page-layout">
    <!-- å·¦ä¸Šè¿”å›éµ -->
    <div class="top-bar">
      <a href="/welcome" class="back-button">
        <img src="/static/return.jpg" alt="è¿”å›" class="back-icon">
         <span class="back-text">Back</span>
</a>
    </div>

    <div class="main-grid">
      <!-- å·¦é‚Šï¼šè¼¸å…¥å€ -->
      <div class="input-panel fridge-door animate-door">
        <form method="POST" action="/add">
            
          <div class="fridge-shelf">
            <label>é£Ÿæåç¨±</label>
            <input type="text" name="name" required>
          </div>
          <div class="fridge-shelf">
            <label>åˆ†é¡</label>
            <select name="category" required>
              <option value="è‚‰é¡">è‚‰é¡</option>
              <option value="æµ·é®®">æµ·é®®</option>
              <option value="è”¬èœ">è”¬èœ</option>
              <option value="èª¿å‘³æ–™">èª¿å‘³æ–™</option>
              <option value="å…¶ä»–">å…¶ä»–</option>
            </select>
          </div>
          <div class="fridge-shelf">
            <label>æ•¸é‡</label>
            <input type="text" name="quantity">
          </div>
          <div class="fridge-shelf">
            <label>éæœŸ</label>
            <input type="date" name="expiry">
          </div>
          <button class="add-button" type="submit">+ æ–°å¢é£Ÿæ + </button>
        </form>
      </div>

      <!-- å³é‚Šï¼šç›®å‰å†°ç®±å…§å®¹ -->
      <div class="fridge-contents">
        {% for category, items in categorized.items() %}
          <h3>{{ category }}</h3>
          <ul>
            {% for item in items %}
              {% if item[3]|float > 0 %}
              <li>
                {{ item[1] }}ï¼ˆæ•¸é‡ï¼š{{ item[3] }}ï¼ŒéæœŸæ—¥ï¼š{{ item[4] or "æœªè¨­å®š" }}ï¼‰
                <form action="/delete/{{ item[0] }}" method="POST" style="display:inline;">
                  <button type="submit" class="delete-btn">âœ–</button>
                </form>
              </li>
              {% endif %}
            {% endfor %}
          </ul>
        {% endfor %}
      </div>
    </div>

    <!-- å³ä¸‹æœå°‹æ¨è–¦æŒ‰éˆ• -->
    <div class="bottom-right">
    <form id="goForm" method="POST" onsubmit="return false;">
      <button type="button" class="recommend-btn" onclick="handleRecommend()">ğŸ“Œ æœå°‹é£Ÿè­œ</button>
    </form>
    </div>
  </div>

  <script>
    function openFridge() {
      document.querySelector('.fridge-door').classList.add('opened');
    }

    function handleRecommend() {
      {% if near_expiry %}
        let answer = confirm("{{ near_expiry|join('ã€') }} å³å°‡éæœŸï¼Œæ˜¯å¦è¦ç«‹å³æŸ¥è©¢ç›¸é—œé£Ÿè­œï¼Ÿ");
        if (answer) {
          document.getElementById("goForm").action = "/recommend";
          document.getElementById("goForm").submit();  // âœ… ç¢ºå®šæ‰ submitï¼ˆPOSTï¼‰
        } else {
          window.location.href = "/select";             // âœ… å–æ¶ˆç›´æ¥å°é é¢ï¼ˆGETï¼‰
        }
      {% else %}
        window.location.href = "/select";
      {% endif %}
    }
  </script>
  <script>
  function relocateFridgeContents() {
    const inputPanel = document.querySelector('.input-panel');
    const mainGrid = document.querySelector('.main-grid');
    const fridgeContents = document.querySelector('.fridge-contents');

    if (!inputPanel || !mainGrid || !fridgeContents) return;

    const shouldMoveToInput = window.innerWidth < 768;

    // è‹¥è¢å¹•è®Šå°ï¼Œè¦æ”¾é€² inputPanel
    if (shouldMoveToInput && fridgeContents.parentElement !== inputPanel) {
      inputPanel.appendChild(fridgeContents);
    }

    // è‹¥è¢å¹•è®Šå¤§ï¼Œè¦æ”¾å› mainGrid
    if (!shouldMoveToInput && fridgeContents.parentElement !== mainGrid) {
      mainGrid.appendChild(fridgeContents);
    }
  }

  window.addEventListener('resize', relocateFridgeContents);
  window.addEventListener('DOMContentLoaded', relocateFridgeContents);
</script>


</body>
</html>